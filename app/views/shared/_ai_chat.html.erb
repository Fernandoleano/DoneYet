<div 
  data-controller="ai-chat" 
  data-ai-chat-user-name-value="<%= Current.user&.name %>"
  data-ai-chat-user-avatar-value="<%= Current.user&.avatar&.attached? ? url_for(Current.user.avatar) : '' %>"
  class="relative z-50"
>
  <!-- Trigger Button (Navbar) -->
  <button 
    data-ai-chat-target="trigger"
    data-action="click->ai-chat#toggle"
    class="p-2 text-gray-400 hover:text-green-400 transition-colors rounded-full hover:bg-gray-800"
    title="Access Field Intelligence"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/>
    </svg>
  </button>

  <!-- Side Panel Overlay Removed for non-blocking interaction -->


  <!-- Side Panel -->
  <div 
    data-ai-chat-target="window"
    class="fixed top-0 right-0 h-full w-96 bg-gray-900 border-l border-green-900/50 shadow-2xl transform transition-transform duration-300 translate-x-full z-50 flex flex-col font-mono"
  >
    <!-- Header -->
    <div class="p-4 border-b border-green-900/30 bg-gray-900 flex justify-between items-center">
      <h3 class="font-bold text-green-500 tracking-widest uppercase flex items-center gap-2 text-sm">
        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
        Field Intelligence
      </h3>
      <button data-action="click->ai-chat#toggle" class="text-gray-500 hover:text-green-400 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>
      </button>
    </div>

    <!-- Messages -->
    <div 
      data-ai-chat-target="messages"
      class="flex-1 overflow-y-auto p-4 bg-gray-900 space-y-4"
    >
      <div class="flex flex-col gap-1 text-xs">
        <span class="text-green-700 font-bold uppercase">System_Initialized: <%= Time.current.to_i %></span>
        <div class="bg-gray-800 border border-green-900/30 text-green-400 p-3 rounded-br-xl rounded-bl-xl rounded-tr-xl">
          <p>Agent, I am ready to assist. Request mission status or initiate protocols.</p>
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="p-4 border-t border-green-900/30 bg-gray-900">
      <form data-action="submit->ai-chat#send" class="flex gap-2">
        <input 
          type="text" 
          data-ai-chat-target="input"
          class="flex-1 bg-gray-800 border border-green-900/50 text-green-400 text-sm px-4 py-2 rounded focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500 placeholder-green-900"
          placeholder="Enter command..."
          autocomplete="off"
        >
        <button 
          type="submit"
          class="p-2 bg-green-900/20 border border-green-500/50 text-green-400 rounded hover:bg-green-900/40 hover:text-green-300 transition-colors"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
        </button>
      </form>
    </div>
  </div>
</div>
